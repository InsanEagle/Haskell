   -- „¥¬®­áâà æ¨ï áâà®ª®¢®© à¥¤ãªæ¨¨ ª®¬¡¨­ â®à­®£® ¢ëà ¦¥­¨ï.
   -- à®£à ¬¬  à ¡®â ¥â ¢ ¨­â¥à¯à¥â â®à¥ ghci.
   --
   -- €¢â®à: Œ®áª¢¨­ „.. (20.02.2007)
   -- ********************************
   module StrRed
   where
   ---------------------------------------
   -- ‘âàãªâãà   «£¥¡à ¨çáª®£® â¨¯  ¤ ­­ëå
   ---------------------------------------
   data Cmb =  Cmb String   -- ª®¬¡¨­ â®à
             | (:#) Cmb Cmb --  ¯¯«¨ª æ¨ï ª®¬¡¨­ â®à®¢ - ª®¬¡¨­ â®à
                            -- (¨­ä¨ªá­ë© ª®­áâàãªâ®à)
      deriving (Eq)
   -----------------------
   instance Show Cmb where
      show (Cmb x)   = x
      show (ts :# t) = case t of _ :# _ -> show ts ++ 
                                               "(" ++ show t ++ ")"
                                 _      -> show ts ++ show t
   -------------------------------------------------------------
   -- à¥¤áâ ¢«¥­¨¥ ¨­ä¨ªá­®£®  ª®­áâàãªâ®à  ¯à¨¬¥­¥­¨ï (:#) «¥-
   -- ¢® áá®æ¨ â¨¢­ë¬ á ¯à¨®à¨â¥â®¬ 5,  çâ®¡ë § ¯¨áì ª®¬¡¨­ â®à-
   -- ­®£® ¢ëà ¦¥­¨ï ¡ë«  ¡¥§ «¨è­¨å áª®¡®ª.  ¯à¨¬¥à, ¢ëà ¦¥­¨¥ 
   -- (SK)K==SKK
   -- ¡ã¤¥â ¯à¥¤áâ ¢¨¬® áâà®ª®©
   -- s:#k:#k
   -----------------------------------------------
   -- ‡ ¬¥ç ­¨¥. ‚®§¬®¦­  § ¯¨áì instance Read Cmb
   -----------------------------------------------
   infixl 5 :#
   -----------------------
   -- á­®¢­ë¥ ª®¬¡¨­ â®àë
   -------------------------
   b = Cmb "B" -- ª®¬¯®§¨â®à
   w = Cmb "W" -- ¤ã¡«¨ª â®à
   k = Cmb "K" -- ª ­æ¥«ïâ®à
   i = Cmb "I" -- ¡¥§¤¥«ì­¨ª
   s = Cmb "S" -- ª®­­¥ªâ®à
   c = Cmb "C" -- ¯¥à¬ãâ â®à
   ----------------------------------
   -- ¥á¯¥æ¨ä¨æ¨à®¢ ­­ë¥ ª®¬¡¨­ â®àë
   ----------------------------------
   x = Cmb "x"
   y = Cmb "y"
   z = Cmb "z"
   t = Cmb "t"
   u = Cmb "u"
   v = Cmb "v"
   --------------------------------------------------
   -- ”ã­ªæ¨ï ¯®è £®¢®£® ¢ë¢®¤  à¥§ã«ìâ â  ¯à¨¬¥­¥­¨ï 
   -- ª®¬¡¨­ â®à®¢ ¢ ª®¬¡¨­ â®à­®¬ ¢ëà ¦¥­¨¨
   -----------------------------------------
   modN:: Cmb -> String
   modN cmb = let res = mod1 cmb 
              in if res == cmb then (show cmb) 
                               else ((show cmb) ++ " -> " 
                                                ++ modN res)
   ---------------------------------------------------------
   -- ”ã­ªæ¨ï ¯à¨¬¥­¥­¨ï  á ¬®£®  «¥¢®£® ª®¬¡¨­ â®à  ¢ 
   -- ª®¬¡¨­ â®à­®¬ ¢ëà ¦¥­¨¨, ª®â®àë© ¬®¦­® ¯à¨¬¥­¨âì
   ---------------------------------------------------
   mod1:: Cmb -> Cmb
   mod1 (Cmb c) = (Cmb c)
   ---------------------------
   -- à¨¬¥­¥­¨¥ ª®¬¡¨­ â®à  I
   ---------------------------
   mod1 ((Cmb c) :# t) 
             | c == "I"   = t
             | True       = (Cmb c) :# mod1 t
   ------------------------------------------
   -- à¨¬¥­¥­¨¥ ª®¬¡¨­ â®à®¢ W, K
   -------------------------------
   mod1 ((Cmb c) :# t :# s)
             | c == "W"   = t :# s :# s
             | c == "K"   = t
             | True  = mod1' ((Cmb c) :# t) s
   ------------------------------------------
   -- à¨¬¥­¥­¨¥ ª®¬¡¨­ â®à®¢ B, S, C
   ----------------------------------
   mod1 ((Cmb c) :#t :# s :# u)
             | c == "B"  = t :# (s :# u)
             | c == "S"  = t :# u :# (s :# u)
             | c == "C"  = t :# u :# s
             | True  = mod1' ((Cmb c) :# t :# s) u
   -----------------------------------------------
   mod1 (ts :#t :# s :# u) = mod1' (ts :#t :# s) u
   ------------------------------------------------
   -- ”ã­ªæ¨ï, ¢ëï¢«ïîé ï ¢ ª®¬¡¨­ â®à­®¬ ¢ëà ¦¥­¨¨ 
   -- ¯à¨¬¥­¨¬ë© ª®¬¡¨­ â®à ¨ ¯à¨¬¥­ïîé ï ¥£®
   ------------------------------------------
   mod1' :: Cmb -> Cmb -> Cmb
   mod1' c1 c2 = let res = mod1 c1
                 in if res == c1 then c1 :# mod1 c2 
                                 else res :# c2
   --------------------------------------------
   --  ¡®à ª®¬¡¨­ â®à®¢:
   ----------------------
   -- B ¢ ¡ §¨á¥ SK
   -----------------------------
   b_sk = s:#(k:#s):#k :#x:#y:#z
   -----------------------------
   -- W ¢ ¡ §¨á¥ SK
   -------------------------------------
   w_sk = s:#s:#(k:#(s:#k:#k)) :#x:#y:#z
   -------------------------------------
   -- C ¢ ¡ §¨á¥ SK
   ---------------------------------------------------------------
   c_sk = s:#((s:#(k:#s):#k):#(s:#(k:#s):#k):#s):#(k:#k) :#x:#y:#z
   ---------------------------------------------------------------
   -- I ¢ ¡ §¨á¥ SK
   ------------------
   i_sk = s:#k:#k :#x
   -----------------------------------------
   -- Š®¬¡¨­ â®à ­¥¯®¤¢¨¦­®© â®çª¨ Y (Š àà¨)
   -----------------------------------------
   yCurry = s:#(b:#w:#b):#(b:#w:#b) :#x
   ------------------------------------------
   -- Š®¬¡¨­ â®à ­¥¯®¤¢¨¦­®© â®çª¨ Y (’à®¬¯ )
   ---------------------------------------------------------
   yTromp = s:#s:#k:#(s:#(k:#(s:#s:#(s:#(s:#s:#k)))):#k) :#x
   ---------------------------------------------------------
   -- Š®¬¡¨­ â®à, ­¥ ¨¬¥îé¨© ­®à¬ «ì­®© ä®à¬ë
   ------------------------------------------
   noNF = s:#i:#i:#(s:#i:#i) :#x:#y

   -- ***************************
   -- ¥ã¤ ç­ë¥ â¥áâ®¢ë¥ ¯à¨¬¥àë:
   ------------------------------
   test1 = modN b_sk ==
           "S(KS)Kxyz -> KSx(Kx)yz -> S(Kx)yz -> Kxz(yz) -> x(yz)"
   test2 = modN (c:#i:#x:#(s:#y:#i))
   test3 = take 200 $ modN yCurry
   -- "S(BWB)(BWB)x -> BWBx(BWBx) -> W(Bx)(BWBx) -> 
   -- Bx(BWBx)(BWBx) -> x(BWBx(BWBx)) -> x(W(Bx)(BWBx)) -> 
   -- x(Bx(BWBx)(BWBx)) -> x(x(BWBx(BWBx))) -> x(x(W(Bx)(BWBx))) ->
   -- x(x(Bx(BWBx)(BWBx))) -> x(x(x(BWBx(BWBx)))) -> {Interrupted!}"
   -----------------------------------------------------------------
   test4 = modN (u:#(c:#i:#x):#v:#y)
   test5 = take 200 $ modN yTromp
   test6 = modN (c:#s:#i:#x:#y:#z)
   test7 = modN (s:#k:#k:#x)
   test8 = modN (s :# (k :# s) :# k :# x :# y :# z)
   test9 = modN b_sk
   --------------------------------
   test10 = modN (c :# x :# y :# z)
   test11 = modN (s :# ((s :# (k :# s) :# k) :# 
                 (s :# (k :# s) :# k) :# s) :# 
                 (k :# k):# x :# y :# z)   
                              -- C = S((S(KS)K)(S(KS)K)S)(KK)
   test12 = (==) (z test8) (z test9)
        where z x = reverse $ takeWhile (/='>') $ reverse x
   --------------------------------------------------------
